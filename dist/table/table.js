define("components/table",["jquery","underscore","components/base","Sortable","brix/event"],function(t,e,i,n,a){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var n,a;n=[i(1),i(2),i(3),i(4),i(5),i(7)],a=function(t,e,i,n,a,r){function o(){}var s=".table",c={UUID:0,COLUMN:{ID:"column-id",FIELD:"column-field",NAME:"column-name",RWD:{RANGE:"column-rwd-range",LIMIT:"column-rwd-limit",FADE:"column-rwd-fade",CURSOR:"column-rwd-cursor"},PRIORITY:{FIELDS:"column-priority-fields",TRIGGER:"column-priority-trigger",STATE:"column-priority-state",INDEX:"column-priority-index",PLACEMENT:"column-priority-placement",ALIGN:"column-priority-align"}}};return e.extend(o.prototype,i.prototype,{options:{},init:function(){this.$element=t(this.element)},render:function(){var i=this;n(this.element,function(t,e,n){i.trigger("toggle"+s,[e,n]),i.contextual()});var o,h;if(this.options[c.COLUMN.RWD.RANGE]){o=a(this,this.options,c,function(t,e){i.trigger("change"+a.NAMESPACE,[e])});var d="resize.table_"+this.clientId;t(window).on(d,e.throttle(function(){o.beautify()},50))}this.options[c.COLUMN.PRIORITY.TRIGGER]&&(h=r(this,this.options,c,function(t,e){i.trigger("change"+r.NAMESPACE,[e]),o.flush()}),this.options[c.COLUMN.PRIORITY.FIELDS]&&h.fields(this.options[c.COLUMN.PRIORITY.FIELDS])),this.columnRWDHandler=o,this.columnPriorityHandler=h},contextual:function(){e.each(this.$element.find("input:checkbox"),function(e){var i=t(e).prop("checked");t(e).closest("tr")[i?"addClass":"removeClass"]("active")})},destroy:function(){var e="resize.table_"+this.clientId;t(window).off(e),e="click"+r.NAMESPACE+"_"+this.clientId,t(document.body).off(e),this.columnPriorityHandler&&this.columnPriorityHandler.$manager.undelegate(this.columnPriorityHandler.$relatedElement)}}),o.extend=i.extend,o}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e){t.exports=i},function(t,e,i){var n,a;n=[i(1),i(2)],a=function(t,e){function i(e,s){var d=t(e),l="["+c+"],["+h+"]";return n(d,l),t(e).on("change.linkage",l,function(n){if(n.target===n.currentTarget){var c=t(n.currentTarget);a(c,d),r(c,d),o(c,d),s&&s(n,i.val(e),n.currentTarget)}}),i}function n(i,n){var a=i.find(n);e.each(a,function(i){var n=t(i),a=n.attr(c),r=n.attr(h);a===r&&(console.warn(new Error(e.template('<%= a %> and <%= b %> have save value "<%= value %>", may cause the Linkage to recursive search. You should avoid this kind of code.')({a:c,b:h,value:a})).stack),console.warn(i))})}function a(i,n){var r=i.attr(c),o=i.attr(h);if(o&&r!==o){var s=n.find(e.template(d)({name:o}));if(s.length){var u=n.find(e.template(l)({name:o}));if(u.length){var f=u.filter(":checkbox"),p=[];e.each(f,function(t){p.push(!t.indeterminate&&t.checked)});var v=t(e.filter(f,function(t){return t.indeterminate})),m=u.filter(":radio"),g=e.uniq(e.map(m,function(e){return t(e).attr("name")})),I=[];e.each(g,function(t){t&&I.push(!!m.filter('[name="'+t+'"]:checked').length)});var b=e.uniq(p.concat(I));s.prop("indeterminate",!!v.length||2===b.length).prop("checked",!v.length&&(1===b.length&&b[0])),a(s,n)}}}}function r(i,n){var a=i.attr(c),o=i.attr(h),s=i.prop("checked");if(a&&a!==o){var d=n.find(e.template(l)({name:a}));if(d.length){var u=d.not(":disabled");if(u.length){var f=u.filter(":checkbox");f.prop("checked",s);var p=u.filter(":radio");if(s||p.prop("checked",s),s){var v=e.uniq(e.map(p,function(e){return t(e).attr("name")}));e.each(v,function(i){if(i){var n=p.filter('[name="'+i+'"]');if(n.length){var a=e.map(n,function(e){return t(e).prop("checked")});e.indexOf(a,s)===-1&&n.eq(0).prop("checked",s)}}})}e.each(d,function(e){r(t(e),n)})}}}}function o(i,n){if(i.is(":radio")){var o=i.attr("name"),s=n.find('[name="'+o+'"]').not(i);e.each(s,function(e){var i=t(e);a(i,n),r(i,n)})}}var s="data-linkage-",c=s+"name",h=s+"parent-name",d="["+c+'="<%= name %>"]',l="["+h+'="<%= name %>"]';return i.off=function(e){var n=t(e),a="["+c+"],["+h+"]";return n.off("click.linkage",a),i},i.val=function(n,o){var s=t(n);if(o){var c=s.find("input:checkbox, input:radio").not(":disabled").prop("checked",!1);return e.each(o,function(i){var n=c.filter('[value="'+i+'"]').prop("checked",!0);e.each(n,function(e){a(t(e),s),r(t(e),s)})}),i}o=[];var h=s.find("input:checkbox:checked, input:radio:checked");return e.each(h,function(e){var i=t(e).attr("value");void 0!==i&&""!==i&&o.push(i)}),o},i}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(1),i(2),i(6)],a=function(t,e,i){function n(e,i,n,r){var h=i[n.COLUMN.RWD.RANGE]||[0,-1],d=i[n.COLUMN.RWD.CURSOR]||1,l=i[n.COLUMN.RWD.LIMIT]||5,u=i[n.COLUMN.RWD.FADE]||!1,f=t(e.element),p=s(n,f,h,d,l),v=a(f,'<span class="brixfont chevron-left">&#xe62f;</span>'),m=a(f,'<span class="brixfont chevron-right">&#xe630;</span>'),g={Constant:n,$table:f,range:h,cursor:d,limit:l,fade:u,state:p,$leftArrow:v,$rightArrow:m,callback:r};return o(g),setTimeout(function(){c(g)},100),{state:p,flush:function(t){return s(n,f,h,t||d,l,p),c(g),this},beautify:function(){return c(g),this}}}function a(i,n){var a=i.find("> thead"),r=e.template(d)({text:n,height:a.height()}),o=t(r).insertAfter(i).offset({top:a.offset().top});return o}function r(t,e){s(e.Constant,e.$table,e.range,e.state.cursor,e.state.limit,e.state),c(e),t.preventDefault(),t.stopPropagation()}function o(e){e.$leftArrow.on("click"+h,function(t){e.state.moveToPrev(),r(t,e),e.callback&&e.callback(t,e.state,t.currentTarget)}),e.$rightArrow.on("click"+h,function(t){e.state.moveToNext(),r(t,e),e.callback&&e.callback(t,e.state,t.currentTarget)}),e.fade?e.$table.hover(function(){e.$leftArrow.fadeIn("fast"),e.$rightArrow.fadeIn("fast"),c(e)},function(i){i.relatedTarget===e.$leftArrow.get(0)||t.contains(e.$leftArrow.get(0),i.relatedTarget)||i.relatedTarget===e.$rightArrow.get(0)||t.contains(e.$rightArrow.get(0),i.relatedTarget)||(e.$leftArrow.fadeOut("fast"),e.$rightArrow.fadeOut("fast"))}):(e.$leftArrow.show(),e.$rightArrow.show(),c(e))}function s(n,a,r,o,s,c){var h=a.find("> thead"),d=a.find("> tbody"),l=h.find("> tr > th");r[0]=(+r[0]+l.length)%l.length,r[1]=(+r[1]+l.length)%l.length,e.each(l,function(e,i){if(e=t(e),i>=r[0]&&i<r[1]){if(void 0!==e.data(n.COLUMN.ID))return;e.attr("data-"+n.COLUMN.ID,n.UUID++)}}),l=e.filter(l,function(t,e){return e>=r[0]&&(0===r[1]||e<r[1])});var f=t(l[0]).prev();l.sort(function(e,i){var a=t(e),r=t(i);return e=+a.attr("data-"+n.COLUMN.PRIORITY.INDEX),i=+r.attr("data-"+n.COLUMN.PRIORITY.INDEX),isNaN(e)&&(e=a.index()),isNaN(i)&&(i=r.index()),e-i}),e.each(l,function(i,n){var a=t(i).index();0===n?f.after(i):t(l[n-1]).after(i);var r=t(i).index(),o=d.find("> tr > td:nth-child("+(a+1)+")");e.each(o,function(e,i){t(e).siblings(":nth-child("+r+")").after(e)})}),l=e.filter(l,function(e){var i=t(e),a=i.data(n.COLUMN.ID),r=i.attr("data-"+n.COLUMN.PRIORITY.STATE);return void 0!==a&&"hide"!==r}),l=t(l),c?(c.setTotal(l.length),c.setCursor(o)):c=new i(l.length,o,s);for(var p,v,m=0;m<c.total;m++)p=m>=c.start&&m<c.end?"show":"hide",v=l.eq(m)[p]().index(),a.find(e.template(u)({nth:v+1}))[p]();return c}function c(t){t.fade||(t.$leftArrow.show(),t.$rightArrow.show());var i=t.$table.find("> thead"),n=i.height(),a=i.offset().top,r=t.$table.find(e.template(l)({nth:t.range[1]+1}));t.$leftArrow.css({height:n,"line-height":n+"px"}).offset({top:a,left:r.offset().left-t.$rightArrow.width()-(t.state.hasNext?t.$leftArrow.width():0)}),t.$rightArrow.css({height:n,"line-height":n+"px"}).offset({top:a,left:r.offset().left-t.$rightArrow.width()}),t.state.total&&t.state.hasPrev||t.$leftArrow.hide(),t.state.total&&t.state.hasNext||t.$rightArrow.hide()}var h=".table_column_rwd",d='<div class="column-scroll-arrow"><%= text %></div>',l="> thead > tr > th:nth-child(<%= nth %>)",u="> tbody > tr > td:nth-child(<%= nth %>)";return n.NAMESPACE=h,n}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n;n=function(){return function(e){function i(t,e,i){this.data="number"==typeof t||"string"==typeof t?void 0:t,this.total=this.data?this.data.length:parseInt(t,10),this.cursor=parseInt(e,10),this.limit=parseInt(i,10),this.calc()}return i.prototype={calc:function(){return this.total&&parseInt(this.total,10)>0?(this.limit=this.limit<1?1:this.limit,this.pages=this.total%this.limit===0?this.total/this.limit:this.total/this.limit+1,this.pages=parseInt(this.pages,10),this.cursor=this.cursor>this.pages?this.pages:this.cursor,this.cursor=this.cursor<1?this.pages>0?1:0:this.cursor,this.start=(this.cursor-1)*this.limit,this.start=this.start<0?0:this.start,this.end=this.start+this.limit>this.total?this.total:this.start+this.limit,this.end=this.total<this.limit?this.total:this.end,this.hasPrev=this.cursor>1,this.hasNext=this.cursor<this.pages,this.hasFirst=this.hasPrev,this.hasLast=this.hasNext,this.prev=this.hasPrev?this.cursor-1:0,this.next=this.hasNext?this.cursor+1:0,this.first=this.hasFirst?1:0,this.last=this.hasLast?this.pages:0,this.focus=this.focus?this.focus:0,this.focus=this.focus%this.limit+this.start,this.focus=this.focus>this.end-1?this.end-1:this.focus):(this.pages=this.cursor=this.start=this.end=0,this.hasPrev=this.hasNext=this.hasFirst=this.hasLast=!1,this.prev=this.next=this.first=this.last=0,this.focus=0),this},moveTo:function(t){return this.cursor=parseInt(t,10),this.calc()},moveToPrev:function(){return this.moveTo(this.cursor-1)},moveToNext:function(){return this.moveTo(this.cursor+1)},moveToFirst:function(){return this.moveTo(1)},moveToLast:function(){return this.moveTo(this.pages)},fetch:function(t){return(t||this.data).slice(this.start,this.end)},setData:function(t){return this.data=t,this.total=t.length,this.calc()},setTotal:function(t){return this.total=parseInt(t,10),this.calc()},setCursor:function(t){return this.cursor=parseInt(t,10),this.calc()},setFocus:function(t){return this.focus=parseInt(t,10),this.focus<0&&(this.focus+=this.total),this.focus>=this.total&&(this.focus-=this.total),this.cursor=parseInt(this.focus/this.limit,10)+1,this.calc()},setLimit:function(t){return this.limit=parseInt(t,10),this.calc()},get:function(t){return void 0!==t?this.data[t%this.data.length]:this.data[this.focus]},toString:function(){return JSON.stringify(this,null,4)}},i.prototype.to=i.prototype.moveTo,i.prototype.toPrev=i.prototype.moveToPrev,i.prototype.toNext=i.prototype.moveToNext,i.prototype.toFirst=i.prototype.moveToFirst,i.prototype.toLast=i.prototype.moveToLast,"undefined"!=typeof t&&t.exports?t.exports=i:e.State=i,i}(this)}.call(e,i,e,t),!(void 0!==n&&(t.exports=n))},function(t,e,i){var n,a;n=[i(1),i(2),i(8),i(9),i(10),i(11)],a=function(t,e,i,n,a,r){function o(n,a,r,o){var c=t(a[r.COLUMN.PRIORITY.TRIGGER]),p=a[r.COLUMN.PRIORITY.PLACEMENT]||"bottom",m=a[r.COLUMN.PRIORITY.ALIGN]||"right",g=t(n.element),I=s(r,g);l(c,I,p,m),f(n,c,I);var b=u(r,g,c,I,o),N=I.find(".queue .sortable-wrapper");return N.length&&i.create(N[0],{handle:".item-move",animation:150,onEnd:function(){var i={},n=I.find(".queue .sortable-wrapper .item");e.each(n,function(e,n){var a=t(e),o=a.data(r.COLUMN.ID);i[o]=n,a.attr("data-"+r.COLUMN.PRIORITY.INDEX,n)});var a=g.find("> thead th");e.each(a,function(e){var n=t(e),a=n.data(r.COLUMN.ID);void 0!==a&&n.attr("data-"+r.COLUMN.PRIORITY.INDEX,i[a])})}}),I.on("change"+v,"input:checkbox",function(e){var i=t(e.target),n=i.data(r.COLUMN.ID),a=i.prop("checked");I.find(".queue .sortable-wrapper .item").filter("[data-"+r.COLUMN.ID+'="'+n+'"]')[a?"slideDown":"slideUp"]("fast")}),{$relatedElement:I,$manager:b,toggle:function(){I.toggle()},show:function(){I.show()},hide:function(){I.hide()},fields:function(i){if(i){var n=I.find(".candidates input:checkbox"),a=I.find(".queue .sortable-wrapper .item"),s=[];return e.each(n,function(n){var o=t(n),c=o.data(r.COLUMN.FIELD),h=e.indexOf(i,c);o.prop("checked",h!==-1).triggerHandler("change"+v);var d=a.filter("[data-"+r.COLUMN.FIELD+'="'+c+'"]');h===-1?d.hide():(d.show(),s[h]=d)}),e.each(s,function(e,i){e&&(0===i?t(e).parent().prepend(e):s[i-1].after(e))}),h(r,g,I),o&&o(void 0,i),this}return d(r,I)}}}function s(i,n){var a=p(i,n),o=e.template(r)(a),s=t(o).insertAfter(n);return s}function c(t,e,i,n){var r=a(t,e,i,n),o=parseInt(e.css("margin-left"),10)||0,s=parseInt(e.css("margin-top"),10)||0;return{left:r.left+o,top:r.top+s}}function h(i,n,a){var r=a.find(".candidates input:checkbox");return e.each(r,function(e){var a=t(e),r=a.data(i.COLUMN.ID);if(void 0!==r){var o=a.prop("checked"),s=o?"show":"hide",c=n.find("> thead th[data-"+i.COLUMN.ID+'="'+r+'"]').attr("data-"+i.COLUMN.PRIORITY.STATE,s)[s]();n.find("> tbody td:nth-child("+(c.index()+1)+")").attr("data-"+i.COLUMN.PRIORITY.STATE,s)[s]()}}),d(i,a)}function d(i,n){var a=[],r=n.find(".queue .sortable-wrapper .item");return e.each(r,function(e){var n=t(e);"none"!==n.css("display")&&a.push(n.data(i.COLUMN.FIELD)||n.data(i.COLUMN.NAME))}),a}function l(e,i,n,a){e.on("click"+v,function(){return i.is(":visible")?(i.hide(),void t(document.body).removeClass("modal-open")):void i.show().offset(c(e,i,n,a))})}function u(t,e,i,a,r){var o=new n("bx-"),s={submit:function(i){var n=h(t,e,a);r&&r(i,n,i.currentTarget),a.hide()},cancel:function(){a.hide()},all:function(){a.find(".candidates input:checkbox").prop("checked",!0),a.find(".queue .sortable-wrapper .item").show()},clear:function(){a.find(".candidates input:checkbox").prop("checked",!1),a.find(".queue .sortable-wrapper .item").hide()}};return o.delegate(a,s),o}function f(e,i,n){var a="click"+v+"_"+e.clientId;t(document.body).off(a).on(a,function(e){!i[0]||e.target===i[0]||t.contains(i[0],e.target)||e.target===n[0]||t.contains(n[0],e.target)||(t(document.body).removeClass("modal-open"),n.hide())})}function p(i,n){var a=n.find("> thead th"),r=!1,o=[],s=[],c=e.map(a,function(e,n){var a=t(e),c=a.data(i.COLUMN.NAME);if(c||(c=t.trim(a.text()),a.attr("data-"+i.COLUMN.NAME,c)),c)return void 0===a.data(i.COLUMN.ID)?void(r?s:o).push({index:n,name:c}):(r=!0,{index:n,id:a.data(i.COLUMN.ID),name:c,field:a.data(i.COLUMN.FIELD)||c})});return c=e.filter(c,function(t){return!!t}),{Constant:i,candidates:c,leftImmovables:o,rightImmovables:s}}var v=".table_column_priority";return o.NAMESPACE=v,o}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e){t.exports=n},function(t,e){t.exports=a},function(t,e,i){var n,a;n=[i(1)],a=function(t){function e(e,n,a,s){var c=t(e);if(!c.length)return i(n);var h=c.offset(),d=h.left,l=h.top,u=c.outerWidth(),f=c.outerHeight(),p=t(n),v="none"!==p.css("display");p.show();var m=p.outerWidth(),g=p.outerHeight();v||p.hide();var I,b,N=u/2-m/2,x=f/2-g/2;switch(a){case"top":I=d+N,b=l-g;break;case"bottom":I=d+N,b=l+f;break;case"left":I=d-m,b=l+x;break;case"right":I=d+u,b=l+x}if(r.test(a)!==r.test(s)&&o.test(a)!==o.test(s))switch(s){case"top":b=l;break;case"bottom":b=l+f-g;break;case"left":I=d;break;case"right":I=d+u-m}return{left:I,top:b}}function i(e,i){var n,a;if(i)n=parseFloat(e,12),a=parseFloat(i,12);else{var r=t(e),o="none"!==r.css("display");r.show(),n=r.outerWidth(),a=r.outerHeight(),o||r.hide()}var s=t(window),c=s.width(),h=s.height(),d=s.scrollLeft(),l=s.scrollTop();return{left:c/2-n/2+d,top:h/2-a/2+l}}function n(e,i,n){var a=t(e),r="none"!==a.css("display");a.show();var o=a.outerWidth(),s=a.outerHeight();r||a.hide();var c={opacity:0,left:i.left,top:i.top};switch(n){case"top":c.top=c.top-.5*s;break;case"bottom":c.top=c.top+.5*s;break;case"left":c.left=c.left-.5*o;break;case"right":default:c.left=c.left+.5*o}return c}function a(t,e){return{opacity:1,left:e.left,top:e.top}}var r=/top|bottom/,o=/left|right/;return e.center=i,e.start=n,e.end=a,e}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n;n=function(){return'<div class="dialog column-priority">\n    <div class="dialog-content">\n        <div class="dialog-header row">\n            <div class="col-xs-8">\n                <h4>\n                    <span>请选择列</span>\n                    <small>\n                        <a href="javascript: void(0);" bx-click="all">全选</a>\n                        <a href="javascript: void(0);" bx-click="clear">清空</a>\n                    </small>\n                </h4>\n            </div>\n            <div class="col-xs-4">\n                <h4>自定义列顺序</h4>\n            </div>\n        </div>\n        <div class="dialog-body row">\n            <div class="col-xs-8 candidates">\n                <% for ( var i = 0; i < candidates.length; i++ ) { %>\n                <label class="item">\n                    <input type="checkbox" \n                        data-<%= Constant.COLUMN.ID %>="<%= candidates[i].id %>" \n                        data-<%= Constant.COLUMN.NAME %>="<%= candidates[i].name %>" \n                        data-<%= Constant.COLUMN.FIELD %>="<%= candidates[i].field %>" \n                        data-<%= Constant.COLUMN.PRIORITY.INDEX %>="<%= candidates[i].index %>" \n                        checked>\n                    <span title="<%= candidates[i].name %>"><%= candidates[i].name %></span>\n                </label>\n                <% } %>\n            </div>\n            <div class="col-xs-4 queue">\n                <!-- immovables -->\n                <div>\n                    <% for( var i = 0; i < leftImmovables.length; i++ ) { %>\n                    <div class="item item-not-allowed">\n                        <span><%= leftImmovables[i].name %></span>\n                    </div>\n                    <% } %>\n                </div>\n                <div class="sortable-wrapper">\n                    <% for ( var i = 0; i < candidates.length; i++ ) { %>\n                    <div class="item item-move" \n                        data-<%= Constant.COLUMN.ID %>="<%= candidates[i].id %>" \n                        data-<%= Constant.COLUMN.NAME %>="<%= candidates[i].name %>" \n                        data-<%= Constant.COLUMN.FIELD %>="<%= candidates[i].field %>" \n                        data-<%= Constant.COLUMN.PRIORITY.INDEX %>="<%= candidates[i].index %>">\n                        <span class="item-name" title="<%= candidates[i].name %>"><%= candidates[i].name %></span>\n                    </div>\n                    <% } %>\n                </div>\n                <div>\n                    <% for( var i = 0; i < rightImmovables.length; i++ ) { %>\n                    <div class="item item-not-allowed">\n                        <span><%= rightImmovables[i].name %></span>\n                    </div>\n                    <% } %>\n                </div>\n            </div>\n        </div>\n        <div class="dialog-footer">\n            <button bx-click="submit" class="btn btn-default btn-sm">确定</button>\n            <a bx-click="cancel" href="javascript: void(0);">取消</a>\n        </div>\n    </div>\n</div>'}.call(e,i,e,t),!(void 0!==n&&(t.exports=n))}])});